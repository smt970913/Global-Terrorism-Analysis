---
title: "Terrorism Analytics-EDA"
author: "Maotong Sun; Qiuyi Chen"
date: "2/11/2020"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

**Introduction**

We will use the data from the Global Terrorism Database (GTD). The database contains more than 180,000 Terrorist Attacks worldwide from 1970 through 2017. We are also going to use the World GDP (current US dolloars, 1960-2018), World Military Expendituture (current US dolloars, 1960-2018), and World Military Expenditure (% of GDP) from the World Bank Open Data to help our data analysis.

Our final goal is to develop a predictive model that can tell us about how many terrorist attacks will happen one year. Also, we would like to study the influenceing factors of terrorist activities, such as economy development and military expendituture.

The first part of our project is exploring the GTD. We are going to do exploratory data analysis on the dataset.

**CoNVO statement**

- Context: 
 - Defense and intelligence departments, and think tanks want to know the relationship between economy development, population     growth and military expenditure.  Government can consider taking some measures in advance.    

- Needs: 
 - Display the negative influence on economy development brought by increasing terrorist attacks, as well as the positive effect    of eliminating terrorism on economy can be shown.
 - For some countries, such as Afghanistan and Iraq, we want to know the effects of the war by comparing their current economy     situations with those before so-called "War on terror".
 - We also want to estimate the risk of increasing terrorist attacks based on the economy development in some countries.

- Vision:
 - Finally, we may develope several persuasive predictive models of terrorism activities so that not only the relationship among    terrorism, economy development, population growth and military expendituture can be shown, but also the number of terrorist     attacks in different countries and cities could be predicted. 

- Outcome:
 - Defense and intelligence analysts could get lots of useful information and powerful predictive tools for terrorism analysis.
 - Other people could understand the development of terrorism from last century better from the result.
 - The success of this project would decrease terrorist attacks around the world.

## 1. Loading the required package and the dataset
```{r}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(readr)
library(gridExtra)
library(ggmap)
library(rworldmap)
library(arules)
library(ggpubr)
library(car)
library(caret)
library(zoo)
library(ggfortify)
library(data.table)
library(ggthemes)
library(plotly)
library(viridis)
library(GGally)

options(warn = -1)
```

```{r}
# GTdata <- read_csv("C:/Users/Vincy/Desktop/Data Science/project/globalterrorismdb_0718dist.csv")
GTdata <- read.csv("D:\\Pitt_2\\Data Science\\gtd\\globalterrorismdb_0718dist.csv")

# GDPdata <- read_csv("C:/Users/Vincy/Desktop/Data Science/project/GDP.csv")
GDPdata <- read.csv("D:\\Pitt_2\\Data Science\\API_NY.GDP.MKTP.CD_DS2_en_csv_v2_713242\\GDP.csv")

# MilEXPdata <- read_csv("C:/Users/Vincy/Desktop/Data Science/project/MLE.csv")
MilEXPdata <- read.csv("D:\\Pitt_2\\Data Science\\API_MS.MIL.XPND.CD_DS2_en_csv_v2_716872\\MLE.csv")

# MilEGdata <- read_csv("C:/Users/Vincy/Desktop/Data Science/project/MLE_G.csv")
MilEGdata <- read.csv("D:\\Pitt_2\\Data Science\\API_MS.MIL.XPND.GD.ZS_DS2_en_csv_v2_712990\\MLE_G.csv")
```

## 2. Data Cleaning
- Removing unnecessary variables.
- Renaming some variables in all four datasets.
- We are going to focus for the sake of keeping our analysis clear on a subset of variables.
```{r}
GTdata_sub <- GTdata %>%
  select(iyear, imonth, iday, country_txt, region_txt, city, latitude, longitude, summary, multiple, attacktype1_txt, 
         targtype1_txt, targsubtype1_txt, gname, weaptype1_txt, nkill, nwound, nkillter)

GTdata_sub <- GTdata_sub %>% 
  rename(year = iyear, month = imonth, day = iday, country = country_txt, 
         region = region_txt, multiple_attack = multiple, attacktype = attacktype1_txt, target_type = targtype1_txt, 
         target_sub_type = targsubtype1_txt, group_name = gname, weapon_type = weaptype1_txt)

GTdata_sub <- GTdata_sub %>%
  mutate(decade = 
           ifelse(year<1980, '70s', 
                  ifelse(year < 1990, '80s', 
                         ifelse(year < 2000, '90s', 
                                ifelse( year < 2010, '2000s', '2010s')))))

GTdata_sub$decade <- factor(GTdata_sub$decade, levels=c("70s", "80s", "90s", "2000s", "2010s"))
names(GTdata_sub)

GDPdata <- GDPdata %>%
  rename(
    Country_Name = ï..Country.Name,
    Country_Code = Country.Code,
    Indicator_Name = Indicator.Name,
    Indicator_Code = Indicator.Code
  )
names(GDPdata)

MilEXPdata <- MilEXPdata %>%
  rename(
    Country_Name = ï..Country.Name,
    Country_Code = Country.Code,
    Indicator_Name = Indicator.Name,
    Indicator_Code = Indicator.Code
  )
names(MilEXPdata)

MilEGdata <- MilEGdata %>%
  rename(
    Country_Name = ï..Country.Name,
    Country_Code = Country.Code,
    Indicator_Name = Indicator.Name,
    Indicator_Code = Indicator.Code
  )
names(MilEGdata)
```

## 3. Data Overview
```{r}
glimpse(GTdata)
glimpse(GTdata_sub)
glimpse(GDPdata)
glimpse(MilEXPdata)
glimpse(MilEGdata)
```

- Trend of Terrorist Attacks over the year
```{r}
count_attack = setDT(GTdata_sub)[,.N,by = year]

ggplot(count_attack,aes(year, N ,col = "red")) + 
  geom_line() + 
  geom_point(col = "black", size = 1.3) +
  theme_economist() + 
  theme(legend.position = "null", plot.title = element_text(size = 15,hjust = 0.5), axis.text.x = element_text(angle = 90)) +
  labs(x = "Year",y = "Count of Attacks", title = "Trend of Terrorist Attacks over the year") + 
  scale_x_continuous(limits = c(1970, 2017), breaks = seq(1970, 2017, 2))
```
  The trend clearly indicates that there has been an rise in terrorist attacks after 2001 Afghanistan War and 2003 Iraq War

```{r}
GTdata_sub %>% 
  summarise(nr_of_attacks = n())
```
  Over 180,000 attacks happening, and they seem to have gone up!
  
- Attack type distribution
```{r}
par(mfrow = c(1, 2))

ggplot(data = GTdata_sub, aes(x = attacktype)) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
  geom_histogram(stat = 'count') + 
  labs(title = 'Terrorism attack type distribution')

ggplot(data = GTdata_sub, aes(x = attacktype, y = year)) + 
  geom_violin(fill = "firebrick2", color = "firebrick2") + 
  coord_flip() + 
  labs(title = 'Terrorism attack type distribution')
```

- Target distribution
```{r}
ggplot(data = GTdata_sub, aes(x = target_type, fill=decade)) +
  geom_bar(stat='count') +
  theme(axis.text.x= element_text(angle=45, hjust=1)) + 
  coord_flip() +
  labs(title='Target distribution of terrorism over time')
```

```{r}
GTdata_sub %>%
  group_by(target_type) %>%
  summarise(nr_of_attacks = n()) %>%
  arrange(desc(nr_of_attacks))
```
  It seems private citizens have become a bigger target
  
- Locations of terrorism
 - We want to see where  the terrorist attacks happen around the world.
```{r}
ggplot(data = GTdata_sub, aes(x = region, y = year)) + 
  geom_violin(fill = "firebrick2", color = "firebrick2") + 
  coord_flip() + 
  labs(title = 'Regions under terrorism in different periods')
```
  No data of Central Asia before 1993, because most countries in Central Asia used to be part of USSR.

- Let's view the top 10 locations for terrorist attacks by region, country and city
```{r}
GTdata_sub %>%
  group_by(region) %>%
  summarise(nr_of_attacks = n()) %>%
  arrange(desc(nr_of_attacks)) %>%
  head(n=10)
GTdata_sub %>%
  group_by(country) %>%
  summarise(nr_of_attacks = n()) %>%
  arrange(desc(nr_of_attacks)) %>%
  head(n=10)
GTdata_sub %>%
  filter(city != 'Unknown') %>%
  group_by(city) %>%
  summarise(nr_of_attacks = n()) %>%
  arrange(desc(nr_of_attacks)) %>%
  head(n=10)
```
- Middle East & North Africa, South Asia and South America are the top three regioins in terms of attacks. Iraq, Pakistan,        Afghanistan, India and Colombia are the top five countries in terms of number of attacks

```{r}
top20_countries <- GTdata_sub %>%
  group_by(region, country) %>%
  summarise(nr_of_attacks = n()) %>%
  mutate(percent = nr_of_attacks/sum(nr_of_attacks))%>%
  arrange(desc(nr_of_attacks)) %>%
  head(n=20)

#visual by country
ggplot(data = top20_countries) +
  stat_summary(aes(x = country, y = nr_of_attacks, fill = region), geom="bar") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
  labs(title = 'Amount of terrorist attacks per country and region')
```

- Distribution of terrorist groups
```{r}
top10_groups <- GTdata_sub %>%
  filter(group_name != "Unknown") %>%
  group_by(group_name) %>%
  summarise(nr_of_attacks = n()) %>%
  arrange(desc(nr_of_attacks)) %>%
  head(n=10)

top10_groups
```

```{r}
ggplot(data=top10_groups) +
  stat_summary(aes(x=group_name, y=nr_of_attacks), geom="bar") +
  theme(axis.text.x= element_text(angle=45, hjust=1)) +
  labs(title='Terrorist attacks per group')
```

- Let's look at the activity of groups over time
```{r}
top10_groups_activity <- GTdata_sub %>%
  filter(GTdata_sub$group_name %in% c("Taliban", "Islamic State of Iraq and the Levant (ISIL)", "Shining Path (SL)", 
                              "Farabundo Marti National Liberation Front (FMLN)", "Al-Shabaab", "New People's Army (NPA)",
                              "Irish Republican Army (IRA)", "Revolutionary Armed Forces of Colombia (FARC)",
                              "Boko Haram", "Kurdistan Workers' Party (PKK)")) %>%
  select(year, group_name) %>% 
  group_by(year, group_name) %>%
  summarise(nr_of_attacks = n()) %>%
  arrange(desc(nr_of_attacks)) %>%
  top_n(n = 10, wt = nr_of_attacks)

#Visual by Top 10 Terror Group Activity  / decade since 1970
ggplot(data = top10_groups_activity, aes(x = year, y = nr_of_attacks, col = group_name, group = group_name)) +
  geom_line(size = 1, alpha = 0.5) + 
  theme(legend.position = "right")+
  labs(title = 'Terrorist Group activity over time') +
  theme(legend.position = "bottom", legend.text=element_text(size = 3.5))
```

- Now we are going to get a deep look into the number of affected people/properties.
- Firstly, the number of killed.
```{r}
par(mfrow = c(1, 3))

plot_0 <- GTdata_sub %>%
  group_by(year) %>%
  summarise(Killed = sum(nkill, na.rm = T)) %>%
  ggplot(aes(year, Killed)) +
  geom_line(stat = "identity", color = "firebrick2")+
  geom_point(color = "firebrick2")+
  labs(title = "Number of killed people over time")

ggplotly(plot_0)

plot_1 <- GTdata_sub %>%
  mutate(Type = reorder(attacktype, nkill, sum, na.rm = T)) %>%
  group_by(year, Type) %>%
  summarise(Killed = sum(nkill, na.rm = T)) %>%
  ggplot(aes(year, Type)) +
  geom_tile(aes(fill = Killed))+
  scale_fill_viridis_c()+
  labs(title = "Killed frequency by Type")

ggplotly(plot_1)

plot_2 <- GTdata_sub %>%
  mutate(Region = reorder(region, nkill, sum, na.rm = T)) %>%
  group_by(year, Region) %>%
  summarise(Killed = sum(nkill, na.rm = T)) %>%
  ggplot(aes(year, Region)) +
  geom_tile(aes(fill = Killed))+
  scale_fill_viridis_c()+
  labs(title = "Killed frequency by Region")

ggplotly(plot_2)
```

- Similarly, we can have a look at the number of wounded.
```{r}
par(mfrow = c(1, 3))

plot_0 <- GTdata_sub %>%
  group_by(year) %>%
  summarise(Wounded = sum(nwound, na.rm = T)) %>%
  ggplot(aes(year, Wounded)) +
  geom_line(stat = "identity", color = "firebrick2")+
  geom_point(color = "firebrick2")+
  labs(title = "Number of Wounded people over time")

ggplotly(plot_0)

plot_1 <- GTdata_sub %>%
  mutate(Type = reorder(attacktype, nwound, sum, na.rm = T)) %>%
  group_by(year, Type) %>%
  summarise(Wounded = sum(nwound, na.rm = T)) %>%
  ggplot(aes(year, Type)) +
  geom_tile(aes(fill = Wounded))+
  scale_fill_viridis_c()+
  labs(title = "Wounded frequency by Type")

ggplotly(plot_1)

plot_2 <- GTdata_sub %>%
  mutate(Region = reorder(region, nwound, sum, na.rm = T)) %>%
  group_by(year, Region) %>%
  summarise(Wounded = sum(nwound, na.rm = T)) %>%
  ggplot(aes(year, Region)) +
  geom_tile(aes(fill = Wounded))+
  scale_fill_viridis_c()+
  labs(title = "Wounded frequency by Region")

ggplotly(plot_2)
```
The rise of ISIS in 2014 and USA's 9/11 in 2001 can be identified from the figure "Number of killed people over time" and "Number of Wounded people over time".

Also, we can have a look at the killed and wounded people by type.
```{r}
par(mfrow = c(1, 2))

ggplot(data = GTdata_sub, aes(attacktype, nkill)) + 
  geom_bar(stat = 'identity', fill = 'firebrick2') + 
  coord_flip() + 
  labs(title = 'Number of people killed by Type')

ggplot(data = GTdata_sub, aes(attacktype, nwound)) +
  geom_bar(stat = 'identity', fill = 'firebrick2') +
  coord_flip() +
  labs(title = 'Number of people wounded by Type')
```
Although 'Armed Assault' has made the most victims, the amount of wounded people caused by 'Bombing/Explosion' is almost 4 times more than that caused by 'Armed Assault'.

- Variables Pairsplot
 - We select Pakistan to see the relationship among several variables.
 - We choose the data points after 1980 USSR invading Afghanistan, because the security     situation of Pakistan became much worse after that.

```{r}
gtdata <- read.csv("D:\\Pitt_2\\Data Science\\globalterrorismdb_0718dist\\globalterrorismdb_0718dist.csv")

GTdata_pairs <- gtdata %>% 
  select(iyear, country_txt, nkill, nwound, nkillter, GDP, MLE, MLE_G)

GTdata_pairs <- GTdata_pairs %>% 
  rename(year = iyear, country = country_txt)

for (i in 3:8) {
  GTdata_pairs[, i] <- as.numeric(as.character(GTdata_pairs[, i], na.rm = T))
}

df <- GTdata_pairs %>% 
  filter(country == 'Pakistan') %>% 
  filter(year >= 1980) %>% 
  group_by(year, country) %>% 
  summarise(killed = sum(na.omit(nkill)), wounded = sum(na.omit(nwound)),killters = sum(na.omit(nkillter)),
            GDP = mean(na.omit(GDP)),MLE = mean(na.omit(MLE)),MLE_G = mean(na.omit(MLE_G)))

df<-df[,-c(1,2)]

ggpairs(df)
```

## 4. Location of Terrorism
```{r}
## Select the data points after from 2001
GTdata_sub_2000 <- GTdata_sub %>% 
  filter(year > 2000)

world <- borders("world", colour = "gray50", fill = "gray50")
worldmap <- ggplot() + world + scale_y_continuous(limits=c(-55, 90))
worldmap + 
  geom_point(aes(x = GTdata_sub_2000$longitude[GTdata_sub$nkill<51], y = GTdata_sub_2000$latitude[GTdata_sub$nkill<51]),
             col='blue', alpha= 0.2) +
  geom_point(aes(x = GTdata_sub_2000$longitude[GTdata_sub$nkill>50], y = GTdata_sub_2000$latitude[GTdata_sub$nkill>50]),
             col='red', size=2) +
  labs(title='Location of terrorist attacks by severity')
```